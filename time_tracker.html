<!doctype html>
<html lang="en">

<head>
    <title>Time Tracker</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="compress.min.js"></script>
    <script src="time_tracker.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.5/dist/cdn.min.js"></script>
    <style>
        button {
            background-color: #03cea4;
            border: none;
            border-radius: 5px;
            padding: 5px;
            color: #2a2b3d;
            font-weight: bold;
            margin: 5px;
            cursor: pointer;
        }

        button.grey {
            background-color: #2a2b3d;
            color: #a0a0a0;
        }

        hr {
            border: none;
            border-bottom: solid #2a2b3d 1px;
        }

        input {
            background-color: #2a2b3d;
            border: none;
            border-radius: 5px;
            padding: 5px;
            color: white;
            font-weight: bold;
            margin: 5px;
        }

        .grey {
            color: #a0a0a0;
        }

        body {
            background-color: #1d1e2c;
            color: white;
        }

        a {
            color: #a0a0a0;
        }

        a::visited {
            color: #a0a0a0;
        }

        .trackedProject {
            animation: fadein 0.5s;
            transition-property: transform, opacity;
            transition-duration: 0.3s;
            transition-timing-function: ease-in-out;
        }

        @keyframes fadein {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }
    </style>
</head>

<body>
    <div x-data="{
        project: '',
        id: 0,
        currentId: null,
        tracked: [],
        total: 0,
        deleteTrackedProject: function (trackedProject) {
            const trackedProjectElement = document.getElementById('trackedProject-' + trackedProject.id);
            trackedProjectElement.style.transform = 'translateX(-100%)';
            trackedProjectElement.style.opacity = '0';
            setTimeout(() => {
                this.tracked = this.tracked.filter((trackedProjectInList) => {
                        return trackedProjectInList.id != trackedProject.id;
                    });
                }, 300);
            },
        }" x-init="
        setInterval(() => {
            if (tracked.length > 0 && tracked[0].id == currentId) {
                tracked[0].end = new Date();
            }
            total = tracked.reduce((acc, trackedProject) => {
                if (trackedProject.end) {
                    return acc + (trackedProject.end - trackedProject.start);
                }
                return acc;
            }, 0);
        }, 1000);
        " style="padding: 10px;">
        <div>
            <input type="text" x-model:value="project" placeholder="Project name..." />
            <button x-on:click="
            tracked.unshift({
                id: id,
                name: project,
                start: new Date(),
                end: new Date(),
                comment: 'Worked on ' + project
            });
            currentId = id;
            id++
            ">
                <i class="bi bi-play-fill"></i>
                <span>
                    Track project
                </span>
            </button>
            <span style="float: right; text-align: center;">
                <div style="font-size: small;" class="grey">TOTAL</div>
                <div x-text="getDurationStringFromMilliseconds(total)"></div>
            </span>
        </div>
        <hr />
        <div>
            <template x-for="(trackedProject, index) in tracked" :key="trackedProject.id">
                <div class="trackedProject" x-bind:id="'trackedProject-' + trackedProject.id"
                    style="border-radius: 5px; padding: 10px; margin: 5px; background-color: #2a2b3d;"
                    :style="{border: (currentId == trackedProject.id ? 'solid #03cea4 2px' : '')}">
                    <div>
                        <span x-show="currentId == trackedProject.id">
                            <button x-on:click="currentId = null">
                                <i class="bi bi-stop-fill"></i>
                                <span>Stop tracking</span>
                            </button>
                        </span>
                        <span x-show="index == 0 && currentId != trackedProject.id">
                            <button x-on:click="currentId = trackedProject.id">
                                Continue tracking
                                <strong>without</strong> break
                            </button>
                            <button x-on:click="
                                        tracked.unshift({
                                            id: id,
                                            name: trackedProject.name,
                                            start: new Date(),
                                            end: new Date(),
                                            comment: trackedProject.comment
                                        });
                                        currentId = id;
                                        id++
                                        ">
                                Continue tracking
                                <strong>with</strong> break
                            </button>
                        </span>
                        <span x-show="index != 0 && currentId != trackedProject.id">
                            <button x-on:click="
                                        tracked.unshift({
                                            id: id,
                                            name: trackedProject.name,
                                            start: new Date(),
                                            end: new Date(),
                                            comment: trackedProject.comment
                                        });
                                        currentId = id;
                                        id++
                            ">
                                Continue tracking
                            </button>
                        </span>
                        <span x-show="currentId != trackedProject.id" style="float: right;" x-data="{confirm: false}">
                            <button x-show="confirm == false" x-on:click="confirm = true">
                                <i class="bi bi-trash-fill"></i>
                                <span>Delete</span>
                            </button>
                            <span x-show="confirm == true">
                                <button class="grey" x-on:click="confirm = false">
                                    Cancel
                                </button>
                                <button x-on:click="
                                            deleteTrackedProject(trackedProject);
                                            confirm = false;
                                        ">
                                    Confirm
                                </button>
                            </span>
                    </div>
                    <div contenteditable="true" x-init="$el.innerText = trackedProject.name"
                        x-on:input="trackedProject.name = $event.target.innerText"
                        style="font-weight: bold; font-size: 24px"></div>
                    <div style="display: flex; flex-direction: row">
                        <div style="
                                    flex-shrink: 0;
                                    padding-right: 10px;
                                    border-right: solid white 1px;
                                ">
                            <template x-if="trackedProject.end">
                                <div>
                                    <div>
                                        <span x-text="trackedProject.end.toTimeString().substring(0,8)"></span>
                                        <span style="display: inline-block; width: 50px;" class="grey">END</span>
                                    </div>
                                    <div style="
                                                border-left: solid white 1px;
                                                padding-left: 10px;
                                            " x-text="getDurationString(trackedProject.start, trackedProject.end)">
                                    </div>
                                </div>
                            </template>
                            <div>
                                <span x-text="trackedProject.start.toTimeString().substring(0,8)"></span>
                                <span style="display: inline-block; width: 50px;" class="grey">START</span>
                            </div>
                        </div>
                        <div style="margin-left: 10px; flex-grow: 1" contenteditable="true"
                            x-init="$el.innerText = trackedProject.comment"
                            x-on:input="trackedProject.comment = $event.target.innerText"></div>
                    </div>
                </div>
            </template>
        </div>
        <button class="grey" x-on:click="console.log(tracked)" style="float: right">
            Print data to console
        </button>
    </div>
</body>

</html>
